'' test_pin_mapping.spin2 - Pin Mapping Test
'' Counts binary pattern on OLED pins to identify actual pin assignments
''
'' OLED Pin assignments from README:
''   Bit 0 = Pin 16 (DIN/MOSI)
''   Bit 1 = Pin 18 (CLK/SCLK)
''   Bit 2 = Pin 20 (CS)
''   Bit 3 = Pin 22 (DC)
''   Bit 4 = Pin 23 (RST)

CON
  _clkfreq = 250_000_000

  ' OLED pins (non-consecutive!)
  PIN_0 = 16    ' DIN (MOSI) - Bit 0
  PIN_1 = 18    ' CLK (SCLK) - Bit 1
  PIN_2 = 20    ' CS         - Bit 2
  PIN_3 = 22    ' DC         - Bit 3
  PIN_4 = 23    ' RST        - Bit 4

  DELAY_MS = 100      ' Delay between counts (100ms)

DAT
  pins    long  16, 18, 20, 22, 23   ' Pin numbers to test

PUB main() | counter, idx, value, pin_num

  debug("Pin Mapping Test Started", 13, 10)
  debug("Testing OLED pins: P16, P18, P20, P22, P23", 13, 10)
  debug("Counting 0-31 with ", udec(DELAY_MS), "ms delay", 13, 10)
  debug("Expected bit positions:", 13, 10)
  debug("  Bit 0 = P16 (DIN/MOSI)", 13, 10)
  debug("  Bit 1 = P18 (CLK/SCLK)", 13, 10)
  debug("  Bit 2 = P20 (CS)", 13, 10)
  debug("  Bit 3 = P22 (DC)", 13, 10)
  debug("  Bit 4 = P23 (RST)", 13, 10)

  ' Set all test pins as outputs, starting low
  repeat idx from 0 to 4
    pinlow(long[@pins][idx])

  debug("Pins initialized. Starting count...", 13, 10)

  ' Count forever
  counter := 0
  repeat
    ' Write counter value to pins
    value := counter
    repeat idx from 0 to 4
      pin_num := long[@pins][idx]
      if (value & 1)
        pinhigh(pin_num)
      else
        pinlow(pin_num)
      value >>= 1

    ' Print current count every 8 values
    if (counter & $07) == 0
      debug("Count: ", udec(counter), 13, 10)

    ' Delay
    waitms(DELAY_MS)

    ' Increment and wrap at 32
    counter := (counter + 1) & $1F
